<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SSH Manager</title>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="app-container">
    <!-- Compact Mode Layout (outside normal flex structure) -->
    <div class="compact-layout" id="compact-layout" style="display: none;">
      <header class="app-header">
        <h1>SSH Manager</h1>
        <nav class="menu-bar">
          <div class="menu-item" id="file-menu-compact">
            <span class="menu-label">File</span>
            <div class="dropdown-menu" id="file-dropdown-compact">
              <div class="menu-option" data-action="add-connection" data-shortcut="Ctrl+N">
                <span>Add Connection</span>
                <span class="shortcut">Ctrl+N</span>
              </div>
              <div class="menu-separator"></div>
              <div class="menu-option" data-action="export-connections" data-shortcut="Ctrl+E">
                <span>Export Connections</span>
                <span class="shortcut">Ctrl+E</span>
              </div>
              <div class="menu-option" data-action="import-connections" data-shortcut="Ctrl+O">
                <span>Import Connections</span>
                <span class="shortcut">Ctrl+O</span>
              </div>
              <div class="menu-separator"></div>
              <div class="menu-option" data-action="settings">
                <span>Settings</span>
              </div>
            </div>
          </div>
          <div class="menu-item" id="view-menu-compact">
            <span class="menu-label">View</span>
            <div class="dropdown-menu" id="view-dropdown-compact">
              <div class="menu-option" data-action="compact-mode" data-shortcut="Ctrl+1">
                <span>Compact Mode</span>
                <span class="shortcut">Ctrl+1</span>
              </div>
              <div class="menu-option" data-action="full-mode" data-shortcut="Ctrl+2">
                <span>Full Details</span>
                <span class="shortcut">Ctrl+2</span>
              </div>
              <div class="menu-separator"></div>
              <div class="menu-option" data-action="refresh" data-shortcut="Ctrl+R">
                <span>Refresh</span>
                <span class="shortcut">Ctrl+R</span>
              </div>
            </div>
          </div>
        </nav>
      </header>
      
      <div class="compact-content">
        <div class="compact-sidebar">
          <div class="sidebar-section">
            <div class="section-header">
              <h3>SSH Connections</h3>
              <button class="btn-icon" id="add-group-btn-compact" title="Add Group">‚ûï</button>
            </div>
            <div class="tree-container" id="groups-tree-compact">
              <!-- Groups will be dynamically populated -->
            </div>
          </div>

          <!-- Compact Mode Action Buttons -->
          <div class="compact-actions" id="compact-actions-embedded">
            <div class="compact-buttons">
              <button class="compact-btn compact-btn-primary" id="compact-connect-btn-embedded">
                üöÄ Connect
              </button>
              <button class="compact-btn compact-btn-secondary" id="compact-details-btn-embedded">
                üìÑ Show Full Details
              </button>
              <button class="compact-btn compact-btn-secondary" id="compact-edit-btn-embedded">
                ‚úèÔ∏è Edit
              </button>
            </div>
            <div class="compact-info" id="compact-info-embedded">
              <div class="compact-connection-details">
                <span class="compact-connection-text">Select a connection</span>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <header class="app-header">
      <h1>SSH Manager</h1>
      <nav class="menu-bar">
        <div class="menu-item" id="file-menu">
          <span class="menu-label">File</span>
          <div class="dropdown-menu" id="file-dropdown">
            <div class="menu-option" data-action="add-connection" data-shortcut="Ctrl+N">
              <span>Add Connection</span>
              <span class="shortcut">Ctrl+N</span>
            </div>
            <div class="menu-separator"></div>
            <div class="menu-option" data-action="export-connections" data-shortcut="Ctrl+E">
              <span>Export Connections</span>
              <span class="shortcut">Ctrl+E</span>
            </div>
            <div class="menu-option" data-action="import-connections" data-shortcut="Ctrl+O">
              <span>Import Connections</span>
              <span class="shortcut">Ctrl+O</span>
            </div>
            <div class="menu-separator"></div>
            <div class="menu-option" data-action="settings">
              <span>Settings</span>
            </div>
          </div>
        </div>
        <div class="menu-item" id="view-menu">
          <span class="menu-label">View</span>
          <div class="dropdown-menu" id="view-dropdown">
            <div class="menu-option" data-action="compact-mode" data-shortcut="Ctrl+1">
              <span>Compact Mode</span>
              <span class="shortcut">Ctrl+1</span>
            </div>
            <div class="menu-option" data-action="full-mode" data-shortcut="Ctrl+2">
              <span>Full Details</span>
              <span class="shortcut">Ctrl+2</span>
            </div>
            <div class="menu-separator"></div>
            <div class="menu-option" data-action="refresh" data-shortcut="Ctrl+R">
              <span>Refresh</span>
              <span class="shortcut">Ctrl+R</span>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <div class="app-content">
      <aside class="sidebar">
        <div class="sidebar-section">
          <div class="section-header">
            <h3>SSH Connections</h3>
            <button class="btn-icon" id="add-group-btn" title="Add Group">‚ûï</button>
          </div>
          <div class="tree-container" id="groups-tree">
            <!-- Groups will be dynamically populated -->
          </div>
        </div>


        <!-- Compact Mode Action Buttons -->
        <div class="compact-actions" id="compact-actions" style="display: none;">
          <div class="compact-buttons">
            <button class="compact-btn compact-btn-primary" id="compact-connect-btn">
              üöÄ Connect
            </button>
            <button class="compact-btn compact-btn-secondary" id="compact-details-btn">
              üìÑ Show Full Details
            </button>
            <button class="compact-btn compact-btn-secondary" id="compact-edit-btn">
              ‚úèÔ∏è Edit
            </button>
          </div>
          <div class="compact-info" id="compact-info">
            <div class="compact-connection-details">
              <span class="compact-connection-text">Select a connection</span>
            </div>
          </div>
        </div>
      </aside>

      <main class="main-content">
        <div class="content-header">
          <h2 id="content-title">Connection Details</h2>
          <div class="search-box">
            <input type="text" id="search-input" placeholder="Search connections...">
          </div>
        </div>

        <div class="connection-details-panel">
          <div id="connection-details" class="details-container">
            <div class="welcome-state">
              <div class="welcome-icon">üîó</div>
              <h3>Welcome to SSH Manager</h3>
              <p>Select a connection from the sidebar to view details, or add a new connection to get started.</p>
              <div class="welcome-actions">
                <button class="btn btn-primary" onclick="showAddConnectionForm()">Add First Connection</button>
              </div>
            </div>
          </div>
        </div>
      </main>
    </div>

    <!-- Add Group Modal -->
    <div id="add-group-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Add New Group</h3>
          <button class="modal-close" onclick="hideAddGroupForm()">&times;</button>
        </div>
        <div class="modal-body">
          <form id="add-group-form">
            <div class="form-group">
              <label for="group-name">Group Name</label>
              <input type="text" id="group-name" name="name" required placeholder="e.g., clients, servers, testing" pattern="[a-z0-9-_]{2,}" title="Only lowercase letters, numbers, hyphens, and underscores. At least 2 characters.">
              <small>Use lowercase letters, numbers, hyphens, and underscores only</small>
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary" onclick="hideAddGroupForm()">Cancel</button>
              <button type="submit" class="btn btn-primary">Create Group</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Edit Group Modal -->
    <div id="edit-group-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Rename Group</h3>
          <button class="modal-close" onclick="hideEditGroupForm()">&times;</button>
        </div>
        <div class="modal-body">
          <form id="edit-group-form">
            <input type="hidden" id="edit-group-old-name">
            <div class="form-group">
              <label for="edit-group-name">New Group Name</label>
              <input type="text" id="edit-group-name" name="name" required placeholder="e.g., clients, servers, testing" pattern="[a-z0-9-_]{2,}" title="Only lowercase letters, numbers, hyphens, and underscores. At least 2 characters.">
              <small>Use lowercase letters, numbers, hyphens, and underscores only</small>
            </div>
            <div class="form-actions">
              <button type="button" class="btn btn-secondary" onclick="hideEditGroupForm()">Cancel</button>
              <button type="submit" class="btn btn-primary">Rename Group</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Add Connection Modal -->
    <div id="add-connection-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Add SSH Connection</h3>
          <button class="modal-close" onclick="hideAddConnectionForm()">&times;</button>
        </div>
        <div class="modal-body">
          <form id="add-connection-form">
            <div class="form-group">
              <label for="connection-name">Connection Name</label>
              <input type="text" id="connection-name" name="name" required placeholder="e.g., Production Server">
            </div>

            <div class="form-group">
              <label for="host">Host</label>
              <input type="text" id="host" name="host" required placeholder="e.g., 192.168.1.100 or server.example.com">
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="user">Username</label>
                <input type="text" id="user" name="user" placeholder="e.g., root, ubuntu">
              </div>
              <div class="form-group">
                <label for="port">Port</label>
                <input type="number" id="port" name="port" value="22" min="1" max="65535">
              </div>
            </div>

            <div class="form-group">
              <label for="group">Group</label>
              <select id="group" name="group">
                <option value="personal">Personal</option>
                <option value="work">Work</option>
                <option value="projects">Projects</option>
              </select>
            </div>

            <div class="form-group">
              <label for="template">Template</label>
              <select id="template" name="template">
                <option value="basic-server">Basic Server</option>
                <option value="developer">Developer Workstation</option>
                <option value="aws-ec2">AWS EC2 Instance</option>
                <option value="jump-host">Jump Host</option>
                <option value="development">Development Server</option>
              </select>
            </div>

            <div class="form-group">
              <label for="key-file">SSH Key File</label>
              <input type="text" id="key-file" name="keyFile" placeholder="~/.ssh/id_ed25519">
            </div>

            <!-- Phase 1: Connection Settings -->
            <div class="form-section">
              <h4>Connection Settings</h4>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="connect-timeout">Connect Timeout (seconds)</label>
                  <input type="number" id="connect-timeout" name="connectTimeout" min="1" max="300" value="10" title="How long to wait when establishing connection">
                </div>
                <div class="form-group">
                  <label for="server-alive-interval">Keep-Alive Interval (seconds)</label>
                  <input type="number" id="server-alive-interval" name="serverAliveInterval" min="0" max="3600" value="60" title="Send keep-alive packets every N seconds (0 = disabled)">
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="server-alive-count">Keep-Alive Max Count</label>
                  <input type="number" id="server-alive-count" name="serverAliveCountMax" min="1" max="10" value="3" title="Disconnect after N failed keep-alive attempts">
                </div>
                <div class="form-group">
                  <label for="compression">Compression</label>
                  <select id="compression" name="compression" title="Enable data compression (recommended for slow connections)">
                    <option value="yes" selected>Yes</option>
                    <option value="no">No</option>
                  </select>
                </div>
              </div>
              
              <div class="form-group">
                <label for="strict-host-checking">Host Key Checking</label>
                <select id="strict-host-checking" name="strictHostKeyChecking" title="How to handle unknown host keys">
                  <option value="ask" selected>Ask (Prompt user)</option>
                  <option value="yes">Yes (Strict)</option>
                  <option value="no">No (Insecure)</option>
                </select>
              </div>
            </div>

            <!-- Phase 2: Developer Features -->
            <div class="form-section">
              <h4>Developer Features</h4>
              
              <!-- Connection Multiplexing -->
              <div class="form-row">
                <div class="form-group">
                  <label for="control-master">Connection Multiplexing</label>
                  <select id="control-master" name="controlMaster" title="Reuse SSH connections for faster subsequent connections">
                    <option value="auto" selected>Auto</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="control-persist">Persist Duration</label>
                  <input type="text" id="control-persist" name="controlPersist" value="10m" placeholder="10m" title="How long to keep master connection alive">
                </div>
              </div>
              
              <!-- Forwarding Options -->
              <div class="form-row">
                <div class="form-group">
                  <label for="forward-x11">X11 Forwarding (GUI Apps)</label>
                  <select id="forward-x11" name="forwardX11" title="Enable GUI applications over SSH">
                    <option value="no" selected>No</option>
                    <option value="yes">Yes</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="forward-agent">SSH Agent Forwarding</label>
                  <select id="forward-agent" name="forwardAgent" title="Forward SSH agent for key-based authentication">
                    <option value="no" selected>No (Secure)</option>
                    <option value="yes">Yes (Less Secure)</option>
                  </select>
                </div>
              </div>
              
              <!-- Port Forwarding -->
              <div class="form-group">
                <label for="local-forwards">Local Port Forwards</label>
                <div id="local-forwards-container">
                  <div class="port-forward-row">
                    <input type="number" placeholder="Local Port" name="localPort[]" min="1" max="65535">
                    <input type="text" placeholder="Remote Host" name="remoteHost[]" value="localhost">
                    <input type="number" placeholder="Remote Port" name="remotePort[]" min="1" max="65535">
                    <button type="button" class="btn-small btn-remove" onclick="removeForwardRow(this)">√ó</button>
                  </div>
                </div>
                <button type="button" id="add-local-forward" class="btn-small btn-secondary">+ Add Local Forward</button>
              </div>
              
              <!-- SOCKS Proxy -->
              <div class="form-group">
                <label for="dynamic-forward">SOCKS Proxy Port</label>
                <input type="number" id="dynamic-forward" name="dynamicForward" min="1" max="65535" placeholder="e.g., 1080" title="Dynamic port forwarding for SOCKS proxy">
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn btn-secondary" onclick="hideAddConnectionForm()">Cancel</button>
              <button type="submit" class="btn btn-primary">Add Connection</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Edit Connection Modal -->
    <div id="edit-connection-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3>Edit SSH Connection</h3>
          <button class="modal-close" onclick="hideEditConnectionForm()">&times;</button>
        </div>
        <div class="modal-body">
          <form id="edit-connection-form">
            <input type="hidden" id="edit-connection-original-name" name="originalName">
            <input type="hidden" id="edit-connection-original-group" name="originalGroup">

            <div class="form-group">
              <label for="edit-connection-name">Connection Name</label>
              <input type="text" id="edit-connection-name" name="name" required placeholder="e.g., Production Server">
            </div>

            <div class="form-group">
              <label for="edit-host">Host</label>
              <input type="text" id="edit-host" name="host" required placeholder="e.g., 192.168.1.100 or server.example.com">
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="edit-user">Username</label>
                <input type="text" id="edit-user" name="user" placeholder="e.g., root, ubuntu">
              </div>
              <div class="form-group">
                <label for="edit-port">Port</label>
                <input type="number" id="edit-port" name="port" value="22" min="1" max="65535">
              </div>
            </div>

            <div class="form-group">
              <label for="edit-group">Group</label>
              <select id="edit-group" name="group">
                <option value="personal">Personal</option>
                <option value="work">Work</option>
                <option value="projects">Projects</option>
              </select>
            </div>

            <div class="form-group">
              <label for="edit-template">Template</label>
              <select id="edit-template" name="template">
                <option value="basic-server">Basic Server</option>
                <option value="developer">Developer Workstation</option>
                <option value="aws-ec2">AWS EC2 Instance</option>
                <option value="jump-host">Jump Host</option>
                <option value="development">Development Server</option>
              </select>
            </div>

            <div class="form-group">
              <label for="edit-key-file">SSH Key File</label>
              <input type="text" id="edit-key-file" name="keyFile" placeholder="~/.ssh/id_ed25519">
            </div>

            <!-- Advanced options for jump-host template -->
            <div id="edit-jump-host-options" class="form-group" style="display: none;">
              <label for="edit-jump-host">Jump Host</label>
              <input type="text" id="edit-jump-host" name="jumpHost" placeholder="bastion.example.com">
            </div>

            <!-- Phase 1: Connection Settings -->
            <div class="form-section">
              <h4>Connection Settings</h4>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="edit-connect-timeout">Connect Timeout (seconds)</label>
                  <input type="number" id="edit-connect-timeout" name="connectTimeout" min="1" max="300" value="10" title="How long to wait when establishing connection">
                </div>
                <div class="form-group">
                  <label for="edit-server-alive-interval">Keep-Alive Interval (seconds)</label>
                  <input type="number" id="edit-server-alive-interval" name="serverAliveInterval" min="0" max="3600" value="60" title="Send keep-alive packets every N seconds (0 = disabled)">
                </div>
              </div>
              
              <div class="form-row">
                <div class="form-group">
                  <label for="edit-server-alive-count">Keep-Alive Max Count</label>
                  <input type="number" id="edit-server-alive-count" name="serverAliveCountMax" min="1" max="10" value="3" title="Disconnect after N failed keep-alive attempts">
                </div>
                <div class="form-group">
                  <label for="edit-compression">Compression</label>
                  <select id="edit-compression" name="compression" title="Enable data compression (recommended for slow connections)">
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                  </select>
                </div>
              </div>
              
              <div class="form-group">
                <label for="edit-strict-host-checking">Host Key Checking</label>
                <select id="edit-strict-host-checking" name="strictHostKeyChecking" title="How to handle unknown host keys">
                  <option value="ask">Ask (Prompt user)</option>
                  <option value="yes">Yes (Strict)</option>
                  <option value="no">No (Insecure)</option>
                </select>
              </div>
            </div>

            <!-- Phase 2: Developer Features -->
            <div class="form-section">
              <h4>Developer Features</h4>
              
              <!-- Connection Multiplexing -->
              <div class="form-row">
                <div class="form-group">
                  <label for="edit-control-master">Connection Multiplexing</label>
                  <select id="edit-control-master" name="controlMaster" title="Reuse SSH connections for faster subsequent connections">
                    <option value="auto">Auto</option>
                    <option value="yes">Yes</option>
                    <option value="no">No</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="edit-control-persist">Persist Duration</label>
                  <input type="text" id="edit-control-persist" name="controlPersist" value="10m" placeholder="10m" title="How long to keep master connection alive">
                </div>
              </div>
              
              <!-- Forwarding Options -->
              <div class="form-row">
                <div class="form-group">
                  <label for="edit-forward-x11">X11 Forwarding (GUI Apps)</label>
                  <select id="edit-forward-x11" name="forwardX11" title="Enable GUI applications over SSH">
                    <option value="no">No</option>
                    <option value="yes">Yes</option>
                  </select>
                </div>
                <div class="form-group">
                  <label for="edit-forward-agent">SSH Agent Forwarding</label>
                  <select id="edit-forward-agent" name="forwardAgent" title="Forward SSH agent for key-based authentication">
                    <option value="no">No (Secure)</option>
                    <option value="yes">Yes (Less Secure)</option>
                  </select>
                </div>
              </div>
              
              <!-- Port Forwarding -->
              <div class="form-group">
                <label for="edit-local-forwards">Local Port Forwards</label>
                <div id="edit-local-forwards-container">
                  <div class="port-forward-row">
                    <input type="number" placeholder="Local Port" name="editLocalPort[]" min="1" max="65535">
                    <input type="text" placeholder="Remote Host" name="editRemoteHost[]" value="localhost">
                    <input type="number" placeholder="Remote Port" name="editRemotePort[]" min="1" max="65535">
                    <button type="button" class="btn-small btn-remove" onclick="removeEditForwardRow(this)">√ó</button>
                  </div>
                </div>
                <button type="button" id="add-edit-local-forward" class="btn-small btn-secondary">+ Add Local Forward</button>
              </div>
              
              <!-- SOCKS Proxy -->
              <div class="form-group">
                <label for="edit-dynamic-forward">SOCKS Proxy Port</label>
                <input type="number" id="edit-dynamic-forward" name="dynamicForward" min="1" max="65535" placeholder="e.g., 1080" title="Dynamic port forwarding for SOCKS proxy">
              </div>
            </div>

            <div class="form-actions">
              <button type="button" class="btn btn-secondary" onclick="hideEditConnectionForm()">Cancel</button>
              <button type="submit" class="btn btn-primary">Update Connection</button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Status Bar -->
    <footer class="status-bar">
      <div class="status-left">
        <span id="status-text">Ready</span>
      </div>
      <div class="status-right">
        <span id="connection-count">0 connections</span>
      </div>
    </footer>
  </div>

  <script src="app.js"></script>
</body>
</html>